define("modules/clean/account_page/tabs/connected_apps",["require","exports","tslib","react","react-redux","modules/clean/web_timing_logger","modules/clean/account_page/widgets/connected_services/view","modules/clean/account_page/widgets/linked_apps/view","modules/clean/account_page/util","modules/clean/account_page/widgets/linked_apps/logger"],(function(e,t,n,a,r,o,s,i,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importDefault(a),r=n.__importStar(r);var p=(function(e){function t(t){return e.call(this,t)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){l.logEvent("view_connected_apps_page"),this.checkTTIstate()},t.prototype.componentDidUpdate=function(){this.checkTTIstate()},t.prototype.checkTTIstate=function(){this.props.dataLoadedForTTI&&(o.mark_time_to_view(),o.mark_time_to_interactive())},t.prototype.render=function(){var e=this.props.expBetterConnectedAppsPage,t=c.getCurrentUser(),n=t.role,r=t.id;return a.default.createElement("div",{className:"account-page-tab"},a.default.createElement(s.ConnectedServices,null),a.default.createElement(i.LinkedApps,{userId:r,appType:"user",expBetterConnectedAppsPage:e}),"work"===n&&a.default.createElement(i.LinkedApps,{userId:r,appType:"team",teamName:c.getTeamName(),expBetterConnectedAppsPage:e}))},t})(a.default.Component);t.ConnectedAppsTab=r.connect((function(e){return{dataLoadedForTTI:"ready"===e.connectedServices.loadingState&&"ready"===e.linkedApps.loadingState}}))(p)})),define("modules/clean/account_page/widgets/connected_services/action_creators",["require","exports","tslib","modules/clean/account_page/util","modules/clean/profile_services/profile_services_link","modules/clean/profile_services/profile_services_constants","modules/core/exception","modules/clean/account_page/widgets/connected_services/api"],(function(e,t,n,a,r,o,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importStar(o);var c=new r.ProfileServicesLinkingHandler;function l(e){return void 0===e&&(e=[]),e.map((function(e){return o.ServiceRequestType.to_api_v2(e)}))}t.loadDataIfNecessary=function(){var e=this;return function(t,r){return n.__awaiter(e,void 0,void 0,(function(){var e,o,s,c;return n.__generator(this,(function(n){switch(n.label){case 0:return"never_loaded"!==r().connectedServices.loadingState?[3,3]:(t({type:"connected_services_load_services"}),e=i.getProfileServices(a.getCurrentUser()),o=i.getFeatureAvailability(a.getCurrentUser()),[4,e]);case 1:return s=n.sent(),[4,o];case 2:c=n.sent(),t({type:"connected_services_feature_availability_loaded",features:c.features}),t({type:"connected_services_services_loaded",services:s.services}),n.label=3;case 3:return[2]}}))}))}},t.authUserWithService=function(e,t,a){var r=this;return function(i){return n.__awaiter(r,void 0,Promise,(function(){var r;return n.__generator(this,(function(n){switch(n.label){case 0:return"facebook"===t[".tag"]?(s.assert(!1,"facebook linking has been deprecated"),[2,null]):[4,c.auth_service_with_user_promise(o.default.from_api_service_type(t),e.id,null,a)];case 1:return(r=n.sent()).success&&i({type:"connected_services_service_connected",service_type:o.default.to_api_service_type(r.provider),displayName:r.display_name,granted_permissions:l(r.granted_request_types),missing_permissions:l(r.missing_request_types)}),[2,r]}}))}))}},t.deauthUserWithService=function(e,t){var a=this;return function(r,o){return n.__awaiter(a,void 0,void 0,(function(){return n.__generator(this,(function(n){switch(n.label){case 0:return[4,i.unlinkUserFromService(e,t)];case 1:return n.sent(),r({type:"connected_services_service_disconnected",service_type:t}),[2,!0]}}))}))}}})),define("modules/clean/account_page/widgets/connected_services/api",["require","exports","tslib","modules/clean/api_v2/default_user_client"],(function(e,t,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getProfileServices=function(e){return n.__awaiter(this,void 0,Promise,(function(){return n.__generator(this,(function(t){return[2,new a.DefaultUserApiV2Client(e).ns("profile_services").rpc("list_services",void 0,{})]}))}))},t.getFeatureAvailability=function(e){return n.__awaiter(this,void 0,Promise,(function(){return n.__generator(this,(function(t){return[2,new a.DefaultUserApiV2Client(e).ns("integrations").rpc("are_features_available",{features:[{feature:"profile_card_v2",entry_point:"connected_apps"},{feature:"save_zoom_recordings_to_dropbox"},{feature:"slack_folder_linking"}]},{})]}))}))},t.unlinkUserFromService=function(e,t){return n.__awaiter(this,void 0,Promise,(function(){return n.__generator(this,(function(n){return[2,new a.DefaultUserApiV2Client(e).ns("profile_services").rpc("unlink",{service:t},{}).then((function(e){return e.success})).catch((function(){return!1}))]}))}))}})),define("modules/clean/account_page/widgets/connected_services/view",["require","exports","tslib","react","react-redux","spectrum/tertiary_link","modules/clean/account_page/widgets/connected_services/action_creators","modules/clean/account_page/components/loading","modules/clean/profile_services/profile_services_constants","modules/clean/account_page/util","modules/clean/profile_services/profile_services_link","modules/core/i18n","modules/clean/static_urls","spectrum/modal","modules/clean/react/modal","modules/clean/react/snackbar","deep-integrations/instrumentation/connect_service_flow_wrapper","modules/clean/integrations/log_event","deep-integrations/instrumentation/function_wrapper","deep-integrations/instrumentation/constants","deep-integrations/platform/log_event","deep-integrations/instrumentation/common_context","deep-integrations/instrumentation/instr_feature_component","modules/clean/integrations/performance_timer","deep-integrations/async","spectrum/checkbox/checkbox","modules/clean/api_v2/default_user_client"],(function(e,t,n,a,r,o,s,i,c,l,p,d,u,_,m,f,v,g,h,y,b,k,C,E,S,w,A){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importDefault(a),r=n.__importStar(r),c=n.__importDefault(c);t.ConnectedServicesComponent=function(e){return a.default.createElement(C.InstrFeatureComponent,{logEvent:b.withDefaults(e.logEvent,{feature_name:y.InstrFeatureType.ConnectedServices}),performanceTimer:E.WebPerformanceTimer,criticalAsyncProps:["ready"===e.loadingState?S.fulfilled(null):S.pending]},a.default.createElement(x,n.__assign({},e)))};var x=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.props.fetchServices()},t.prototype.connectService=function(e,t,a){return n.__awaiter(this,void 0,void 0,(function(){var r,o,s;return n.__generator(this,(function(n){switch(n.label){case 0:this.props.logEvent(v.buildStartEvent(t,y.InstrFeatureType.ConnectedServices,y.InstrConnectServiceFlowOutcome.Connected,{service_action:a})),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.props.connectService(e,t.service_type,a)];case 2:return null!=(r=n.sent())&&p.ProfileServicesLinkingHandler.show_import_notifications(r),o=r&&r.success?y.InstrConnectServiceFlowOutcome.Connected:y.InstrConnectServiceFlowOutcome.Error,this.props.logEvent(v.buildEndEvent(t,y.InstrFeatureType.ConnectedServices,y.InstrConnectServiceFlowOutcome.Connected,o,{service_action:a})),[3,4];case 3:return s=n.sent(),this.props.logEvent(v.buildEndEvent(t,y.InstrFeatureType.ConnectedServices,y.InstrConnectServiceFlowOutcome.Connected,y.InstrConnectServiceFlowOutcome.Error,{service_action:a,error:JSON.stringify(s)})),[3,4];case 4:return[2]}}))}))},t.prototype.disconnectService=function(e,t){var n=this;this.props.logEvent(v.buildStartEvent(t,y.InstrFeatureType.ConnectedServices,y.InstrConnectServiceFlowOutcome.Disconnected)),this.props.disconnectService(e,t).then((function(e){return n.props.logEvent(v.buildEndEvent(t,y.InstrFeatureType.ConnectedServices,y.InstrConnectServiceFlowOutcome.Disconnected,e?y.InstrConnectServiceFlowOutcome.Disconnected:y.InstrConnectServiceFlowOutcome.Abort))})).catch((function(e){return n.props.logEvent(v.buildEndEvent(t,y.InstrFeatureType.ConnectedServices,y.InstrConnectServiceFlowOutcome.Disconnected,y.InstrConnectServiceFlowOutcome.Error,{error:JSON.stringify(e)}))}))},t.prototype.renderServiceRow=function(e){var n=c.default.from_api_service_type(e.service_type),r=c.default.from_api_to_name(e.service_type),o=this.getServiceDataWithFeatureCheck(e.service_type,["profile_card_v2","slack_folder_linking"]),s=t.GetConnectedState(r,e.service_type,e.connection_state,"zoom"===e.service_type[".tag"]&&this.isFeatureAvailable("save_zoom_recordings_to_dropbox")),i=s[0],l=s[1];return i||o.action&&"enabled"===e.service_availability[".tag"]?a.default.createElement("div",{"data-service":n,key:n,className:"connected-services__row"},this.renderServiceInfoBlock(e,o.permissions,e.connection_state,e.missing_permissions,o.learn_more_page),this.renderServiceConnectionBlock(e.display_name,i,l,e,o.action)):null},t.prototype.renderServiceConnectionBlock=function(e,t,n,r,o){var s=null,i=h.functionWrapperProvider(this.props.logEvent,y.InstrFeatureType.ConnectedServices);return!t&&o?s=h.onClickWrapper(i,y.InstrActionType.ConnectService,this.connectService.bind(this,l.getCurrentUser(),r,o),{serviceType:r.service_type[".tag"]}):t&&(s="zoom"===r.service_type[".tag"]&&this.isFeatureAvailable("save_zoom_recordings_to_dropbox")?h.onClickWrapper(i,y.InstrActionType.ModifyServiceSettings,this.props.modifyZoomSettings.bind(this,l.getCurrentUser(),r),{serviceType:r.service_type[".tag"]}):h.onClickWrapper(i,y.InstrActionType.DisconnectService,this.disconnectService.bind(this,l.getCurrentUser(),r),{serviceType:r.service_type[".tag"]})),a.default.createElement("div",{className:"connected-services__service-connection-block"},t&&a.default.createElement("img",{className:"connected-services__service-connection-check",src:u.static_url("/static/images/check-green-vfl4z9rpV.svg"),alt:d._("Connected")}),t&&e&&a.default.createElement("span",{className:"connected-services__service-connection-display-name"},e),a.default.createElement("span",{className:"connected-services__action-button"},this.getConnectDisconnectLink(n,s)))},t.prototype.getConnectDisconnectLink=function(e,t){return t?a.default.createElement(o.TertiaryLink,{onClick:t},e):null},t.prototype.renderConnectGoogleCalendar=function(e,n,r){return this.isFeatureAvailable("profile_card_v2")&&"google"===e.service_type[".tag"]&&"is_connected"===n[".tag"]&&t.containsPermission(r,"calendar")&&a.default.createElement("span",{className:"connected-services__service-info-action-button"},this.getConnectDisconnectLink(d._("Connect Google Calendar"),this.connectService.bind(this,l.getCurrentUser(),e,"link_calendar")))},t.prototype.renderConnectSlackFilesRead=function(e,n,r){return this.isFeatureAvailable("slack_folder_linking")&&"slack_dropbox"===e.service_type[".tag"]&&"is_connected"===n[".tag"]&&t.containsPermission(r,"read_files")&&a.default.createElement("span",{className:"connected-services__service-info-action-button"},this.getConnectDisconnectLink(d._("Enable Folder Linking"),this.connectService.bind(this,l.getCurrentUser(),e,"link_read_files")))},t.prototype.renderServiceInfoBlock=function(e,t,n,r,o){var s=this.renderConnectGoogleCalendar(e,n,r),i=this.renderConnectSlackFilesRead(e,n,r),l=c.default.from_api_to_name(e.service_type),p=c.default.from_api_to_img(e.service_type),_=h.functionWrapperProvider(this.props.logEvent,y.InstrFeatureType.ConnectedServices);return a.default.createElement("div",{className:"connected-services__service-info-block"},a.default.createElement("div",null,a.default.createElement("img",{className:"connected-services__service-info-icon",src:u.static_url(p),alt:l})),a.default.createElement("div",{className:"connected-services__service-info-text"},a.default.createElement("div",{className:"connected-services__service-info-name"},l),a.default.createElement("div",{className:"connected-services__service-info-metadata"},a.default.createElement("div",null,t,o&&a.default.createElement("a",{className:"connected-services__service-info-learn-more",onClick:h.onClickWrapper(_,y.InstrActionType.LearnMore,void 0,{serviceType:e.service_type[".tag"]}),href:o,target:"_blank",rel:"noopener noreferrer"},d._("Learn More"))),s,i)))},t.prototype.renderExtensionsTable=function(){var e=n.__spreadArrays(this.props.services);e.sort(this.serviceCompare.bind(this));for(var t=[],r=0,o=e;r<o.length;r++){var s=o[r];t.push(this.renderServiceRow(s))}return a.default.createElement("div",{className:"connected-services"},t)},t.prototype.render=function(){return"ready"!==this.props.loadingState?a.default.createElement("div",{className:"account-page-block account-page-block--connected-apps"},a.default.createElement(i.Loading,null)):a.default.createElement("div",{className:"account-page-block"},a.default.createElement("span",{className:"account-page-block__heading"},d._("Connect apps to Dropbox")),a.default.createElement("p",{className:"account-page-block__subtext"},d._("Integrated features from these apps make it easier to collaborate with people you know on Dropbox.")),this.renderExtensionsTable())},t.prototype.isFeatureAvailable=function(e){for(var t=0,n=this.props.features;t<n.length;t++){var a=n[t];if(a.feature===e&&"available"===a.available[".tag"])return!0}return!1},t.prototype.getServiceDataWithFeatureCheck=function(e,t){for(var n=0,a=t;n<a.length;n++){var r=a[n];if(this.isFeatureAvailable(r)){var o=c.default.get_gated_service_data(e,r);if(o)return o}}return c.default.get_service_data(e)},t.prototype.serviceCompare=function(e,t){var n=this.getServiceDataWithFeatureCheck(e.service_type,["profile_card_v2"]),a=this.getServiceDataWithFeatureCheck(t.service_type,["profile_card_v2"]),r=n.order-a.order;return 0!==r?r:n.friendly_name<a.friendly_name?-1:n.friendly_name>a.friendly_name?1:0},t.containsPermission=function(e,t){return!!e.find((function(e){return e[".tag"]===t}))},t.GetConnectedState=function(e,t,n,a){var r="",o=!1;switch(n[".tag"]){case"never_connected":r=d._("Connect to %(service_name)s").format({service_name:e});break;case"is_connected":r=a?d._("Settings"):d._("Disconnect"),o=!0;break;case"was_connected":case"other":default:r=d._("Reconnect to %(service_name)s").format({service_name:e})}return[o,r]},t})(a.default.Component);function T(e,t){var r=this;return function(o,i){var l=s.deauthUserWithService(e,t.service_type);return new Promise((function(e,s){(function(e,t,n){var r=g.createIntegrationsActionsLogger().logEvent,o=h.functionWrapperProvider(r,y.InstrFeatureType.ConnectedServices),s=c.default.from_api_to_name(e.service_type),i=d._("Disconnect %(service_name)s integration?").format({service_name:s}),l=d.intl.formatMessage(d._("Are you sure you want to disconnect <st>%(service_name)s</st>? You’ll need to reconnect again to continue using %(service_name)s integrations on Dropbox."),{service_name:s,st:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a.default.createElement("strong",null,e)}});m.Modal.showInstance(a.default.createElement(_.UtilityModal,{ariaLabel:i,title:i,overlayClickClose:!0,primaryAction:d._("Disconnect"),secondaryAction:d._("Cancel"),shouldFocusAfterRender:!0,onPrimaryAction:h.onClickWrapper(o,y.InstrActionType.DisconnectServiceConfirm,t,{serviceType:e.service_type[".tag"]}),open:!0,onSecondaryAction:h.onClickWrapper(o,y.InstrActionType.DisconnectServiceAbort,n,{serviceType:e.service_type[".tag"]}),onRequestClose:function(){return m.Modal.close()},appElement:document.getElementById("embedded-app")},l))})(t,(function(){return n.__awaiter(r,void 0,void 0,(function(){var a,r;return n.__generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,l(o,i)];case 1:return(a=n.sent())&&f.Snackbar.complete(d._("Successfully disconnected %(service)s integration").format({service:c.default.from_api_to_name(t.service_type)})),e(a),[3,3];case 2:return r=n.sent(),s(r),[3,3];case 3:return[2]}}))}))}),(function(){e(!1)}))}))}}var N=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleSaveMeetingRecordingsCheckboxChange=function(){n.setState((function(e){return{saveMeetingRecordings:!e.saveMeetingRecordings}}))},n.fetchZoomSettings=function(){n.setState({isFetching:!0}),new A.DefaultUserApiV2Client(n.props.user).ns("integrations").rpc("get_user_settings",{},{}).then((function(e){var t=!(!e.zoom_settings||!e.zoom_settings.save_meeting_recordings),a=!(!e.zoom_settings||!e.zoom_settings.meeting_recordings_disabled_by_admin);n.setState({isFetching:!1,initialSaveMeetingRecordings:t,adminHasDisabledSaveMeetingRecordings:a,saveMeetingRecordings:t})}),(function(e){n.setState({isFetching:!1})}))},n.confirmNewSettings=function(){m.Modal.close();var e=d._("Setting updated."),t=d._("Couldn’t update setting. Try again later.");n.state.saveMeetingRecordings!==n.state.initialSaveMeetingRecordings?new A.DefaultUserApiV2Client(n.props.user).ns("integrations").rpc("set_user_settings",{zoom_settings:{save_meeting_recordings:n.state.saveMeetingRecordings}},{}).then((function(t){f.Snackbar.complete(e)}),(function(e){f.Snackbar.fail(t)})):f.Snackbar.complete(e)},n.state={isFetching:!0,initialSaveMeetingRecordings:!1,adminHasDisabledSaveMeetingRecordings:!1,saveMeetingRecordings:!1},n}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.fetchZoomSettings()},t.prototype.render=function(){var e=g.createIntegrationsActionsLogger().logEvent,t=h.functionWrapperProvider(e,y.InstrFeatureType.ConnectedServices),n=c.default.from_api_to_name(this.props.service.service_type),r=d._("%(service_name)s settings",{comment:"This appears as a heading of a modal view that contains settings related to an app.\n      service_name will be a brand name, such as Slack or Zoom, whose settings the user is changing."}).format({service_name:n});return a.default.createElement(_.UtilityModal,{className:"connected-services__service-settings-modal",ariaLabel:r,title:r,overlayClickClose:!0,primaryAction:d._("Update"),secondaryAction:d._("Cancel"),shouldFocusAfterRender:!0,onPrimaryAction:h.onClickWrapper(t,y.InstrActionType.ModifyServiceSettingsConfirm,this.confirmNewSettings,{serviceType:this.props.service.service_type[".tag"]}),open:!0,link:d._("Disconnect Zoom"),onLink:h.onClickWrapper(t,y.InstrActionType.DisconnectService,this.props.promptDisconnectAction,{serviceType:this.props.service.service_type[".tag"]}),onRequestClose:function(){return m.Modal.close()},appElement:document.getElementById("embedded-app")},this.state.isFetching?a.default.createElement("div",null):a.default.createElement(a.default.Fragment,null,a.default.createElement("div",{className:"connected-services__service-setting-checkbox-container"},a.default.createElement(w.Checkbox,{disabled:this.state.adminHasDisabledSaveMeetingRecordings,checked:this.state.saveMeetingRecordings&&!this.state.adminHasDisabledSaveMeetingRecordings?"checked":"unchecked",onChange:this.handleSaveMeetingRecordingsCheckboxChange,className:"connected-services__service-team-settings-checkbox-symbol"}),a.default.createElement("span",{className:this.state.adminHasDisabledSaveMeetingRecordings?"connected-services__service-setting-checkbox-name--disabled":"connected-services__service-setting-checkbox-name"},a.default.createElement("div",{className:"connected-services__service-setting-checkbox-name-title"},d._("Copy Zoom cloud recordings to Dropbox",{comment:"This is a label on a checkbox relating to settings for the Zoom integration.\n                  When the checkbox is checked, a feature of the integration is enabled.\n                  A more in-depth explanation is given below the checkbox.\n                  Zoom is a brand, and Zoom Meeting is the name of a Zoom product.\n                  Cloud recording is vaguely the name of a Zoom product, but they aren't very consistent about it;\n                    this is specifically contrasted with local recordings."})),a.default.createElement("div",null,d._("After a meeting you host is recorded to Zoom cloud, the recording will be copied from Zoom cloud to your Zoom folder in Dropbox. We’ll notify you when files are copied. This feature requires certain settings in your Zoom account to be enabled.",{comment:"This is an explanation under a checkbox on the settings for the Zoom integration.\n                  Zoom is a brand name.\n                  Cloud recording is vaguely the name of a Zoom product, but they aren't very consistent about its name;\n                    this is specifically contrasted with local recordings, which this feature does not interact with."})," ",a.default.createElement("a",{href:"https://help.dropbox.com/installs-integrations/third-party/zoom#cloudrecordings",target:"_blank",rel:"noopener noreferrer"},d._("Learn more")))))))},t})(a.default.Component);t.ConnectedServices=r.connect((function(e){return{services:e.connectedServices.services,loadingState:e.connectedServices.loadingState,features:e.connectedServices.features,logEvent:k.decorateCommonContext(g.createIntegrationsActionsLogger().logEvent,{serviceList:e.connectedServices.services,featureGates:e.connectedServices.features})}}),(function(e){return{fetchServices:function(){return e(s.loadDataIfNecessary())},connectService:function(t,n,a){return e(s.authUserWithService(t,n,a))},disconnectService:function(t,n){return e(T(t,n))},modifyZoomSettings:function(t,n,r){return e((function(e,t,n){return function(n,r){var o=T(e,t);return new Promise((function(s,i){"zoom"!==t.service_type[".tag"]&&s(!1),m.Modal.showInstance(a.default.createElement(N,{service:t,commitZoomSettingsAction:function(e){f.Snackbar.complete("Committed setting changes")},promptDisconnectAction:function(){try{var e=o(n,r);s(e)}catch(e){i(e)}},abortAction:function(){s(!1)},user:e}))}))}})(t,n))}}}))(t.ConnectedServicesComponent)})),define("modules/clean/account_page/widgets/linked_apps/action_creators",["require","exports","tslib","modules/clean/account_page/widgets/linked_apps/api"],(function(e,t,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadDataIfNecessary=function(e){var t=this;return function(r,o){return n.__awaiter(t,void 0,void 0,(function(){var t;return n.__generator(this,(function(n){switch(n.label){case 0:return"never_loaded"!==o().linkedApps.loadingState?[3,2]:(r({type:"linked_apps_load_apps"}),[4,a.getLinkedApps(e)]);case 1:t=n.sent(),r({type:"linked_apps_apps_loaded",apps:t}),n.label=2;case 2:return[2]}}))}))}},t.unlinkApp=function(e,t,r,o){var s=this;return function(i,c){return n.__awaiter(s,void 0,void 0,(function(){return n.__generator(this,(function(n){switch(n.label){case 0:return i({type:"linked_apps_unlink_app",appType:t,app:r}),"app_action"!==r.type?[3,2]:[4,a.unlinkAppAction(e,r)];case 1:return n.sent(),[3,4];case 2:return[4,a.unlinkApp(e,r,o)];case 3:n.sent(),n.label=4;case 4:return i({type:"linked_apps_app_unlinked",appType:t,app:r}),[2,!0]}}))}))}}})),define("modules/clean/account_page/widgets/linked_apps/api",["require","exports","modules/clean/api_v2/user_client","modules/clean/ajax_as_promised"],(function(e,t,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLinkedApps=function(e){return a.WebRequest({url:"/account/get_linked_apps",subject_user:e,dataType:"json"})},t.unlinkApp=function(e,t,a){return(new n.UserApiV2Client).ns("security_settings").rpc("uninstall_app",{app_id:t.id,keep_sandbox_files:a},{subjectUserId:e})},t.unlinkAppAction=function(e,t){return(new n.UserApiV2Client).ns("security_settings").rpc("uninstall_app_action",{action_id:t.action_id},{subjectUserId:e})}})),define("modules/clean/account_page/widgets/linked_apps/modals",["require","exports","tslib","react","spectrum/checkbox","modules/core/i18n","spectrum/modal","modules/clean/react/modal"],(function(e,t,n,a,r,o,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(t){var n=e.call(this,t)||this;return n.onAccept=function(){n.props.onSubmit(n.props.appInfo,n.state.checked)},n.onToggle=function(e){n.setState({checked:"checked"===e})},n.onClose=function(){i.Modal.close()},n.state={checked:!1},n}return n.__extends(t,e),t.prototype.renderCheckbox=function(e){var t=o._("Also remove <st>%(app_name)s</st> folder from my Dropbox."),n=o.intl.formatMessage(t,{st:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a.default.createElement("strong",null,e)},app_name:e});return a.default.createElement("div",{className:"remove-app-folder"},a.default.createElement(r.Checkbox,{onChange:this.onToggle,className:"remove-app-folder__checkbox",checked:this.state.checked?"checked":"unchecked"}),a.default.createElement("div",null,n))},t.prototype.render=function(){var e=this.props.appInfo,t=e.name,n=o._("Disconnect %(app_name)s?").format({app_name:t}),r=o._("Are you sure you want to disconnect <st>%(app_name)s</st>? This app will no longer have permission to access your Dropbox."),i=o.intl.formatMessage(r,{st:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a.default.createElement("strong",null,e)},app_name:t}),c="app_action"!==e.type&&e.uses_sandbox&&e.app_folder;return a.default.createElement(s.UtilityModal,{id:"linked-apps-dismiss-app-modal",ariaLabel:n,title:n,overlayClickClose:!0,primaryAction:o._("Disconnect"),secondaryAction:o._("Cancel"),shouldFocusAfterRender:!0,onPrimaryAction:this.onAccept,open:!0,onRequestClose:this.onClose,appElement:document.getElementById("embedded-app")},a.default.createElement("div",null,i),c&&this.renderCheckbox(t))},t})((a=n.__importDefault(a)).default.Component);t.DismissAppModal=c})),define("modules/clean/account_page/widgets/linked_apps/view",["require","exports","tslib","react","react-redux","modules/core/i18n","modules/core/uri","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/account_page/components/action_table","modules/clean/account_page/components/info_tooltip","modules/clean/account_page/components/loading","modules/clean/account_page/widgets/linked_apps/action_creators","modules/clean/account_page/widgets/linked_apps/modals","modules/clean/react/snackbar","modules/clean/account_page/components/linked_apps","modules/clean/account_page/widgets/linked_apps/logger"],(function(e,t,n,a,r,o,s,i,c,l,p,d,u,_,m,f,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importDefault(a),r=n.__importStar(r);var g=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(l.ActionTable),h=o._("This app no longer has access to your files because you deleted its app folder. You will need to reinstall the app for it to work again."),y=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.uninstallApp=function(e,a){return n.__awaiter(t,void 0,void 0,(function(){return n.__generator(this,(function(t){switch(t.label){case 0:v.logEvent("click_confirm_disconnect_app",v.appInfoExtras(e)),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.props.unlinkApp(this.props.userId,this.props.appType,e,!a)];case 2:return t.sent(),m.Snackbar.complete(o._("Successfully disconnected %(app_name)s").format({app_name:e.name})),[3,4];case 3:return t.sent(),m.Snackbar.fail(o._("Could not disconnect %(app_name)s, try again later").format({app_name:e.name})),[3,4];case 4:return[2]}}))}))},t.onClosePressed=function(e){v.logEvent("click_disconnect_app",v.appInfoExtras(e)),i.Modal.showInstance(a.default.createElement(_.DismissAppModal,{appInfo:e,onSubmit:t.uninstallApp}))},t.renderAppDetail=function(e,n){switch(n){case"app_name":return t.renderAppName(e);case"publisher":return a.default.createElement(f.LinkedAppsPublisherInfo,{appInfo:e});case"access_type":return t.renderAccessType(e);case"datastore":return t.renderDatastoreExport(e)}return null},t.hideClose=function(e){return"team"===t.props.appType},t.isLinkedAppsEmpty=function(){var e,n=t.props,a=n.appType,r=n.apps,o="user"===a?null==r?void 0:r.user_apps:null==r?void 0:r.team_apps;return 0===(null!==(e=null==o?void 0:o.length)&&void 0!==e?e:0)},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.props.loadApps(this.props.userId)},t.prototype.renderAppName=function(e){var t=e.icon_url?a.default.createElement("img",{src:e.icon_url,className:"action-app-name__icon-img",alt:""}):a.default.createElement(c.Sprite,{group:"web",name:"folder_app",alt:""});return a.default.createElement("div",{className:"app-name"},a.default.createElement("span",{className:"app-name__icon"},t),a.default.createElement("span",null,e.name))},t.prototype.renderAccessType=function(e){var t;t="no_access"===e.access_type?o._("No access - App folder deleted"):"full"===e.access_type?o._("Full Dropbox"):e.access_type,e.pending&&(t=o._("%(access_type)s (Pending)").format({access_type:t}));var n="no_access"===e.access_type?h:e.access_type_desc;return a.default.createElement(p.InfoTooltip,{prompt:t,content:n})},t.prototype.renderDatastoreExport=function(e){if("app_action"!==e.type&&e.datastore){var t=o._("This app has saved data for you in Dropbox datastores, which are no longer supported. Click here to download your data as a CSV file."),n=new s.URI({path:"/developers/apps/datastores/export/"+e.id+"/"+this.props.userId}).toString(),r=a.default.createElement("a",{className:"datastores-link",href:n},o._("Download datastores"));return a.default.createElement(p.InfoTooltip,{prompt:r,content:t})}return!1},t.prototype.renderAppTable=function(){var e=this.props.apps,t="user"===this.props.appType?e.user_apps:e.team_apps,r=t.some((function(e){return"app_action"!==e.type&&e.datastore})),s=["app_name","publisher","access_type"],i={app_name:o._("App name"),publisher:o._("Publisher"),access_type:o._("Access type")};r&&(s.push("datastore"),i.datstore="");var c={keys:s,headers:i,data:t,renderRowDetail:this.renderAppDetail,onClosePressed:this.onClosePressed,hideClose:this.hideClose,dismissAriaLabel:function(e){return o._("Unlink %(app_name)s").format({app_name:e.name})},dismissHeaderAriaLabel:o._("Unlink app"),tableClass:["linked-apps-table"]};return a.default.createElement(g,n.__assign({},c))},t.prototype.getSectionHeaders=function(){if(this.isLinkedAppsEmpty()){if("user"===this.props.appType){var e=o._("You haven’t given any third-party apps access to your Dropbox account.");return[o._("Apps with access to your Dropbox"),e]}return[o._("Apps managed for your team"),e=o._("You haven’t given any third-party apps access to your Dropbox account.")]}if("user"===this.props.appType){var t=o._("You’ve given these apps permission to access your Dropbox files on your behalf.");return[o._("Apps with access to your Dropbox"),t]}var n=this.props.teamName;return[o._("Apps managed for your team"),t=o._("An administrator at %(company_name)s has given these apps access to your %(company_name)s Dropbox account.").format({company_name:n})]},t.prototype.render=function(){var e,t=this.props,n=t.apps,r=t.appType,o=t.expBetterConnectedAppsPage;if("ready"!==t.loadingState)return a.default.createElement("div",{className:"account-page-block account-page-block--linked-apps"},a.default.createElement(d.Loading,null));var s=null!==(e="user"===r?null==n?void 0:n.user_apps:null==n?void 0:n.team_apps)&&void 0!==e?e:[],i=this.getSectionHeaders(),c=i[0],l=i[1];return"ON_SHOW_ACCORDION"===o?a.default.createElement("div",{className:"linked-apps"},a.default.createElement("span",{className:"account-page-block__heading"},c),a.default.createElement("p",{className:"account-page-block__subtext"},l),a.default.createElement(f.LinkedAppsAccordion,{appType:r,appInfos:s,onClickDisconnect:this.uninstallApp})):a.default.createElement("div",{className:"account-page-block account-page-block--linked-apps"},a.default.createElement("span",{className:"account-page-block__heading"},c),a.default.createElement("p",{className:"account-page-block__subtext"},l),!this.isLinkedAppsEmpty()&&this.renderAppTable())},t})(a.default.Component);t.LinkedAppsComponent=y,t.LinkedApps=r.connect((function(e){return{apps:e.linkedApps.apps,loadingState:e.linkedApps.loadingState}}),(function(e){return{loadApps:function(t){return e(u.loadDataIfNecessary(t))},unlinkApp:function(t,n,a,r){return e(u.unlinkApp(t,n,a,r))}}}))(y)})),define("modules/clean/account_page/components/linked_apps",["require","exports","tslib","react","modules/core/i18n","purify","modules/clean/react/css","spectrum-arbor/components/arbor_expander","spectrum/table","dig-components/buttons","dig-components/controls","dig-components/modal","dig-components/typography","dig-components/icons","dig-components/icons/src","modules/clean/datetime","modules/clean/account_page/widgets/linked_apps/logger"],(function(e,t,n,a,r,o,s,i,c,l,p,d,u,_,m,f,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importStar(a),o=n.__importStar(o),t.LinkedAppsPublisherInfo=function(e){var t=e.appInfo,n=t.publisher_company||t.name;return t.publisher_url?a.default.createElement(u.Link,{href:t.publisher_url,target:"_blank",rel:"noopener noreferrer",onClick:function(){return v.logEvent("click_developer_link",v.appInfoExtras(t))},hasNoUnderline:!0},n):a.default.createElement(u.Text,null,n)};var g=function(e){var t=e.appInfo;return a.default.createElement("div",{className:"linked-apps-headline"},t.icon_url?a.default.createElement("img",{src:t.icon_url,className:"linked-apps-headline__icon",alt:""}):a.default.createElement(_.UIIcon,{className:"linked-apps-headline__icon",size:"large",src:m.ImageLine}),a.default.createElement("div",{className:"linked-apps-headline__heading"},a.default.createElement(u.Text,{isBold:!0},t.name),a.default.createElement(u.Text,{size:"small",color:"faint"},t.publisher_company||t.name)))},h=function(e){var t,n=e.appInfo,s=r._("This app no longer has access to your files because you deleted its app folder. You will need to reinstall the app for it to work again."),i="no_access"===n.access_type?s:n.access_type_desc,c="app_action"!==n.type&&(null===(t=n.scope_list_messages)||void 0===t?void 0:t.length)?a.default.createElement("ul",{className:"linked-apps-info-table__value-ul"},n.scope_list_messages.map((function(e){return a.default.createElement("li",{className:"linked-apps-info-table__value-li",key:"id="+n.id+";message="+e,dangerouslySetInnerHTML:{__html:o.sanitize(e)}})}))):null;return null!=c?c:a.default.createElement(u.Text,null,i)},y=function(e){var n=e.appInfo,o=n.first_linked_ts?f.format_date(new Date(n.first_linked_ts),"MMMM d, yyyy"):null;return a.default.createElement(c.Table,{columnFlex:[1,7],className:"linked-apps-info-table"},a.default.createElement(c.TableBody,null,o?a.default.createElement(c.TableRow,{className:"linked-apps-info-table__row"},a.default.createElement(c.TableCell,{className:"linked-apps-info-table__key"},a.default.createElement(u.Text,{color:"faint",isBold:!0},r._("Connected on"))),a.default.createElement(c.TableCell,{className:"linked-apps-info-table__value"},a.default.createElement(u.Text,null,o))):null,a.default.createElement(c.TableRow,{className:"linked-apps-info-table__row"},a.default.createElement(c.TableCell,{className:"linked-apps-info-table__key"},a.default.createElement(u.Text,{color:"faint",isBold:!0},r._("Developer"))),a.default.createElement(c.TableCell,{className:"linked-apps-info-table__value"},a.default.createElement(t.LinkedAppsPublisherInfo,{appInfo:n}))),a.default.createElement(c.TableRow,{className:"linked-apps-info-table__row"},a.default.createElement(c.TableCell,{className:"linked-apps-info-table__key"},a.default.createElement(u.Text,{color:"faint",isBold:!0},r._("Permissions"))),a.default.createElement(c.TableCell,{className:"linked-apps-info-table__value"},a.default.createElement(h,{appInfo:n})))))},b=function(e){var t=e.appName,n=e.checked,o=e.onChange,s=r._("Also remove <st>%(app_name)s</st> folder from my Dropbox."),i=r.intl.formatMessage(s,{st:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a.default.createElement("strong",null,e)},app_name:t});return a.default.createElement("div",{className:"linked-apps-modal__checkbox"},a.default.createElement(p.Checkbox,{checked:n,onChange:o}),a.default.createElement(u.Text,{className:"linked-apps-modal__checkbox-message"},i))},k=function(e){var t=e.open,n=e.appInfo,o=e.onClickClose,s=e.onClickDisconnect,i=r._("Are you sure you want to disconnect <st>%(app_name)s</st>? This app will no longer have permission to access your Dropbox."),c=r.intl.formatMessage(i,{st:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a.default.createElement("strong",null,e)},app_name:n.name}),p="app_action"!==n.type&&n.uses_sandbox&&n.app_folder,_=a.useState(!1),m=_[0],f=_[1];return a.default.createElement(d.Modal,{open:t,overlayClassName:"linked-apps-modal",onRequestClose:o},a.default.createElement(d.Modal.Header,{hasBottomSpacing:"title-standard"},a.default.createElement(u.Title,null,r._("Disconnect %(app_name)s?").format({app_name:n.name}))),a.default.createElement(d.Modal.Body,null,a.default.createElement(u.Text,null,c),p?a.default.createElement(b,{appName:n.name,checked:m,onChange:function(){return f(!m)}}):null),a.default.createElement(d.Modal.Footer,null,a.default.createElement(l.Button,{variant:"opacity",onClick:o,autoFocus:!0},r._("Cancel")),a.default.createElement(l.Button,{variant:"primary",onClick:function(){s(n,m),o()}},r._("Disconnect"))))},C=function(e){var t=e.appInfo,n=e.appType,o=e.onClickDisconnect,s=a.useState(!1),i=s[0],c=s[1];return a.default.createElement("div",{className:"linked-apps-body"},a.default.createElement(y,{appInfo:t}),a.default.createElement("div",{className:"linked-apps-actions"},a.default.createElement(l.Button,{className:"linked-apps-actions__disconnect",variant:"primary",onClick:function(){v.logEvent("click_disconnect_app",v.appInfoExtras(t)),c(!0)},disabled:"team"===n},r._("Disconnect")),a.default.createElement(k,{open:i,appInfo:t,onClickDisconnect:o,onClickClose:function(){return c(!1)}})))},E=function(e,t){var n,a;return(null!==(n=t.first_linked_ts)&&void 0!==n?n:0)-(null!==(a=e.first_linked_ts)&&void 0!==a?a:0)};t.LinkedAppsAccordion=s.requireCssWithComponent((function(e){var t=e.appType,n=e.appInfos,r=e.onClickDisconnect,o=a.useState(),s=o[0],c=o[1],l=n.sort(E),p=l.map((function(e){return{headline:a.default.createElement(g,{appInfo:e}),body:a.default.createElement(C,{appType:t,appInfo:e,onClickDisconnect:r})}}));return a.default.createElement(i.ArborExpander,{items:p,onClick:function(e){var t=l[e];t&&s!==e&&(v.logEvent("click_expand_connected_app_details",v.appInfoExtras(t)),c(e))}})}),["/static/css/spectrum/index.web-vfl_-DzRS.css","/static/css/account/pagelet/index-vflWz2XCb.css","/static/css/dig-components/index.web-vflm0_tak.css","/static/js/spectrum-arbor/index.web-vfltMoziS.css"])})),define("modules/clean/account_page/widgets/linked_apps/logger",["require","exports","tslib","modules/clean/logging/telemetry","modules/clean/logging/hive/schemas/web-app_directory_connected_apps"],(function(e,t,n,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=new((a=n.__importStar(a)).HiveLogger);t.logEvent=function(e,t){var n=new r.AppDirectoryConnectedAppsRow({event_name:e,event_extras:JSON.stringify(t)});o.log(n)},t.appInfoExtras=function(e){return{app_type:e.type,app_id:"api_app"===e.type?e.id:void 0,action_id:"app_action"===e.type?e.action_id:void 0,app_name:e.name}}})),define("modules/clean/logging/hive/schemas/web-app_directory_connected_apps",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){this.category="web-app_directory_connected_apps",this.user_id=null,this.session_id=null,this.request_id=null,this.url=null,this.event_name=e.event_name,this.event_extras=e.event_extras,Object.seal(this)};t.AppDirectoryConnectedAppsRow=n})),define("dig-components/modal",["require","exports","tslib","dig-components/modal/modal"],(function(e,t,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(a,t)})),define("dig-components/modal/body",["require","exports","tslib","react","dig-components/typography/text"],(function(e,t,n,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importStar(a),t.Body=a.forwardRef((function(e,t){var o=e.children,s=e.className,i=void 0===s?"":s,c=n.__rest(e,["children","className"]),l="dig-Modal-content-body "+i;return a.createElement(r.Text,Object.assign({ref:t,className:l,tagName:"div",color:"standard"},c),o)})),t.Body.displayName="Modal.Body"})),define("dig-components/modal/footer",["require","exports","tslib","react","classnames"],(function(e,t,n,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importStar(a),r=n.__importDefault(r),t.Footer=function(e){var t=e.hasTopBorder,o=void 0!==t&&t,s=e.children,i=e.className,c=void 0===i?"":i,l=n.__rest(e,["hasTopBorder","children","className"]),p=r.default("dig-Modal-content-footer",{"dig-Modal-content-footer--hasTopBorder":o},c);return a.createElement("div",Object.assign({className:p},l),s)},t.Footer.displayName="Modal.Footer"})),define("dig-components/modal/header",["require","exports","tslib","react","classnames"],(function(e,t,n,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importStar(a),r=n.__importDefault(r),t.Header=function(e){var t=e.hasBottomSpacing,o=void 0===t?"title-small":t,s=e.children,i=e.className,c=void 0===i?"":i,l=n.__rest(e,["hasBottomSpacing","children","className"]),p=r.default("dig-Modal-content-header",{"dig-Modal-content-header--margin-title-standard":"title-standard"===o},c);return a.createElement("div",Object.assign({className:p},l),s)},t.Header.displayName="Modal.Header"})),define("dig-components/modal/modal",["require","exports","tslib","classnames","react","react-modal","dig-components/buttons","dig-components/icons","dig-components/icons/src","dig-components/modal/header","dig-components/modal/body","dig-components/modal/footer","focus-visible"],(function(e,t,n,a,r,o,s,i,c,l,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importDefault(a),r=n.__importStar(r),o=n.__importDefault(o);var u=function(e){switch(e){case"small":return 450;case"standard":return 600;case"large":return 700}return e};t.Modal=function(e){var t=e.children,l=e.className,p=e.withCloseButton,d=e.width,_=void 0===d?"standard":d,m=e.open,f=void 0!==m&&m,v=e.onRequestClose,g=e.overlayClassName,h=n.__rest(e,["children","className","withCloseButton","width","open","onRequestClose","overlayClassName"]),y=a.default("dig-Modal-content",l),b=v;return r.createElement(o.default,Object.assign({},h,{isOpen:f,shouldCloseOnOverlayClick:!0,onRequestClose:v,className:y,bodyOpenClassName:"dig-Modal-body--open",htmlOpenClassName:"dig-Modal-html--open",overlayClassName:a.default("dig-Modal-overlay",g),closeTimeoutMS:200,style:{content:{width:u(_)}}}),!!p&&r.createElement(s.IconButton,{variant:"transparent",className:"dig-Modal-close-btn","aria-label":p,onClick:b},r.createElement(i.UIIcon,{src:c.CloseLine})),r.createElement("div",{className:"dig-Modal-content-inner"},t))},t.Modal.Header=l.Header,t.Modal.Body=p.Body,t.Modal.Footer=d.Footer,t.Modal.displayName="Modal",t.Modal.setAppElement=o.default.setAppElement}));
//# sourceMappingURL=pkg-account_connected_apps.min.js-vfl1dLDJJ.map