define("modules/clean/react/account_menu/account_menu_v2",["require","exports","tslib","react","modules/clean/ajax_as_promised","modules/clean/analytics","modules/clean/api_v2/user_client","modules/clean/event_handler","modules/clean/react/account_menu/account_menu_types","modules/clean/react/account_menu/account_menu_util","modules/clean/react/account_menu/account_menu_view_v2","modules/clean/snapengage","modules/clean/web_timing_logger","modules/core/browser","modules/core/uri"],(function(e,t,n,a,o,c,u,r,s,l,i,d,m,_,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importDefault(a),_=n.__importStar(_);var f=(function(t){function f(e){var n=t.call(this,e)||this;return n.handleChatLink=function(){n.widgetId&&(d.DropboxSnapEngage.startSupportChat(n.widgetId),c.TeamsWebActionsLogger.log("chat_discoverability_account_menu_clicked"))},n.handleMenuSelection=function(e){switch(e){case s.AccountMenuSelectionOption.SETTINGS:_.redirect(l.SETTINGS_URL);break;case s.AccountMenuSelectionOption.INSTALL:l.handleInstallClick(),_.open_tab(l.INSTALL_URL);break;case s.AccountMenuSelectionOption.CHAT:n.handleChatLink();break;case s.AccountMenuSelectionOption.LOGOUT:_.redirect(l.getLogoutUrl())}},n.apiV2Client=new u.UserApiV2Client,n.state={accountPhotoUrl:n.props.user.photo_circle_url,showChatLink:!1,accountSpaceUsage:{currentStatus:s.AccountSpaceUsageStatus.NOT_APPLICABLE}},n}return n.__extends(f,t),f.prototype.componentDidMount=function(){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(t){switch(t.label){case 0:return this.attachEventListeners(),[4,m.waitForTTI()];case 1:return t.sent(),this.getQuotaData(),this.getChatVariants(),[4,new Promise((function(t,n){e(["modules/clean/account/timezone_detection"],t,n)})).then(n.__importStar)];case 2:return t.sent().checkTimezone(),[2]}}))}))},f.prototype.componentWillUnmount=function(){this.events.removeAll()},f.prototype.attachEventListeners=function(){var e=this;this.events=new r.EventHandler,this.events.on(document,"db:account_photo:photo_set",(function(t,n){var a=p.URI.parse(n.saved_photo_url).updateQuery({size:"64x64"}).toString();e.setState({accountPhotoUrl:a})})),this.events.on(document,"db:account_photo:photo_deleted",(function(){e.setState({accountPhotoUrl:void 0})}))},f.prototype.getQuotaData=function(){return n.__awaiter(this,void 0,void 0,(function(){var e,t,a;return n.__generator(this,(function(n){switch(n.label){case 0:e=this.props.user,this.setState({accountSpaceUsage:{currentStatus:s.AccountSpaceUsageStatus.LOADING}}),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.apiV2Client.ns("users").rpc("get_space_usage",void 0,{subjectUserId:e.id})];case 2:return t=n.sent(),a=t.allocation,this.setState({accountSpaceUsage:{currentStatus:s.AccountSpaceUsageStatus.READY,used:t.used,allocated:a.allocated}}),[3,4];case 3:return n.sent(),this.setState({accountSpaceUsage:{currentStatus:s.AccountSpaceUsageStatus.NOT_APPLICABLE}}),[3,4];case 4:return[2]}}))}))},f.prototype.getChatVariants=function(){return n.__awaiter(this,void 0,void 0,(function(){var e,t;return n.__generator(this,(function(n){switch(n.label){case 0:return e=this.props.user,[4,o.SilentBackgroundRequest({url:"/portkey_chat_discoverability_variant",dataType:"json",subject_user:e.id})];case 1:return(t=n.sent())&&(this.widgetId=t.widgetId,this.setState({showChatLink:"V1"===t.variant&&!!this.widgetId})),[2]}}))}))},f.prototype.render=function(){var e=this.state,t=e.accountPhotoUrl,n=e.showChatLink,o=e.accountSpaceUsage,c=this.props,u=c.showInstallLink,r=c.user;return a.default.createElement(i.AccountMenuView,{user:r,accountPhotoUrl:t,showChatLink:n,showInstallLink:!!u,onMenuSelection:this.handleMenuSelection,accountSpaceUsage:o})},f.defaultProps={showInstallLink:!0},f})(a.default.Component);t.AccountMenuV2=f})),define("modules/clean/react/account_menu/account_menu_quota_bar",["require","exports","tslib","react","dig-components/buttons","dig-components/typography","modules/clean/display_format","modules/clean/react/account_menu/account_menu_types","modules/clean/react/account_menu/account_menu_util","modules/core/i18n"],(function(e,t,n,a,o,c,u,r,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importDefault(a),t.AccountMenuQuotaBar=function(e){var t=e.accountSpaceUsage;if(t.currentStatus===r.AccountSpaceUsageStatus.LOADING)return a.default.createElement("div",null,l._("Loading quota usage..."));var n=t.used,o=t.allocated;return a.default.createElement(i,{used:n,allocated:o})};var i=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){s.handleUpgradeButtonView(s.getUpgradeButtonText())},t.prototype.render=function(){var e=this.props,t=e.used,n=e.allocated,i=Math.min(Math.round(t/n*100),100),d=i>=r.AccountMenuQuotaBarBreakpoints.OVERQUOTA?l._("Free up space or upgrade now"):i>=r.AccountMenuQuotaBarBreakpoints.ALMOST_FULL?l._("Upgrade soon to get more space"):void 0,m=a.default.createElement(o.Button,{className:"account-menu-v2__quota-bar-btn",onClick:s.handleUpgradeButtonClick,size:"small",variant:"transparent"},s.getUpgradeButtonText());return i<r.AccountMenuQuotaBarBreakpoints.STANDARD?a.default.createElement("div",null,a.default.createElement(c.Text,{size:"xsmall",color:"faint"},l._("Your account has %(allocated)s of storage").format({allocated:u.format_bytes(n)})),m):a.default.createElement("div",null,a.default.createElement("div",{className:"account-menu-v2__quota-bar"},a.default.createElement("div",{className:"account-menu-v2__quota-bar-used",style:{width:i+"%"}})),a.default.createElement("div",null,a.default.createElement(c.Text,{size:"xsmall",color:"faint"},l.ungettext("Using %(used)s of %(allocated)s","Using %(used)s of %(allocated)s",t).format({used:u.format_bytes(t),allocated:u.format_bytes(n)}))),d&&a.default.createElement(c.Text,{size:"xsmall",color:"faint"},d),m)},t})(a.default.Component)})),define("modules/clean/react/account_menu/account_menu_user_summary",["require","exports","tslib","react","dig-components/avatar","dig-components/typography","modules/clean/react/account_menu/account_menu_quota_bar","modules/clean/react/account_menu/account_menu_util","modules/clean/react/account_menu/account_menu_types","modules/core/i18n","modules/core/user_i18n"],(function(e,t,n,a,o,c,u,r,s,l,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importDefault(a),i=n.__importStar(i),t.AccountMenuUserSummary=function(e){var t=e.user,n=e.accountPhotoUrl,d=e.accountSpaceUsage,m=i.getInitials(t.display_name);return a.default.createElement("div",{className:"account-menu-v2__user-summary"},a.default.createElement("div",{className:"account-menu-v2__user-summary-info"},a.default.createElement("button",{onClick:r.handleChangeAvatar,"aria-label":n?l._("Change photo"):l._("Add photo"),className:"account-menu-v2__change-photo"},a.default.createElement(o.Avatar,{role:"presentation",src:n,backgroundColor:o.avatarColorForUserIdentifier(m)},m)),a.default.createElement("div",{className:"account-menu-v2__user-name"},a.default.createElement(c.Text,null,t.display_name),a.default.createElement(c.Text,{size:"xsmall",color:"faint"},t.email))),d.currentStatus!==s.AccountSpaceUsageStatus.NOT_APPLICABLE&&a.default.createElement(u.AccountMenuQuotaBar,{accountSpaceUsage:d}))}})),define("modules/clean/react/account_menu/account_menu_view_v2",["require","exports","tslib","react","dig-components/avatar","dig-components/menu","modules/clean/react/account_menu/account_menu_types","modules/clean/react/account_menu/account_menu_user_summary","modules/clean/react/account_menu/account_menu_util","modules/clean/react/css","modules/core/i18n","modules/core/user_i18n"],(function(e,t,n,a,o,c,u,r,s,l,i,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importDefault(a),d=n.__importStar(d);var m=l.requireCssWithComponent((function(e){var t=e.user,l=e.accountPhotoUrl,m=e.accountSpaceUsage,_=e.showChatLink,p=e.showInstallLink,f=e.onMenuSelection,h=d.getInitials(t.display_name);return a.default.createElement(c.Menu.Wrapper,{onToggle:s.handleMenuToggle,onSelection:f},(function(e){var s=e.getTriggerProps,d=e.getContentProps;return a.default.createElement(a.default.Fragment,null,a.default.createElement("span",n.__assign({},s(),{className:"account-menu-v2__trigger"}),a.default.createElement(o.Avatar,{alt:i._("Account menu"),src:l,backgroundColor:o.avatarColorForUserIdentifier(h),className:"account-menu-v2__avatar",size:"small"},h)),a.default.createElement(c.Menu.Content,n.__assign({className:"account-menu-v2__content"},d(),{placement:"bottom-end"}),a.default.createElement(c.Menu.Segment,null,a.default.createElement(r.AccountMenuUserSummary,{user:t,accountPhotoUrl:l,accountSpaceUsage:m})),a.default.createElement(c.Menu.Segment,null,a.default.createElement(c.Menu.ActionItem,{key:u.AccountMenuSelectionOption.SETTINGS,value:u.AccountMenuSelectionOption.SETTINGS},i._("Settings")),p&&a.default.createElement(c.Menu.ActionItem,{key:u.AccountMenuSelectionOption.INSTALL,value:u.AccountMenuSelectionOption.INSTALL},i._("Open the desktop app")),_&&a.default.createElement(c.Menu.ActionItem,{key:u.AccountMenuSelectionOption.CHAT,value:u.AccountMenuSelectionOption.CHAT},i._("Chat with support")),a.default.createElement(c.Menu.ActionItem,{key:u.AccountMenuSelectionOption.LOGOUT,value:u.AccountMenuSelectionOption.LOGOUT},i._("Sign out")))))}))}),["/static/css/account_menu_v2-vflvRgMeY.css","/static/css/dig-components/index.web-vflm0_tak.css"]);t.AccountMenuView=m})),define("modules/clean/react/maestro/layout/pagelet_top_menu_container",["require","exports","tslib","react","spectrum/vertically_fixed","modules/clean/react/account_menu/account_menu","modules/clean/react/account_menu/account_menu_v2","modules/clean/react/maestro/layout/header_conditions","modules/clean/react/user_notifications/dropdown","modules/clean/viewer"],(function(e,t,n,a,o,c,u,r,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.hideInstallLink,n=void 0!==t&&t,i=e.userId,d=e.experiments,m=e.featuresConfig,_=d.useNewAccountPicker,p=l.Viewer.get_viewer(),f=p.get_user_by_id(i),h=r.showAccountMenu(p,f);return a.default.createElement(o.VerticallyFixed,{className:"pagelet-top-menu__container maestro-min-width"},a.default.createElement("div",{className:"pagelet-top-menu__notifications-button-container pagelet-top-menu__element"},!f.is_guest_admin&&a.default.createElement(s.UserNotificationsDropdown,{isPagelet:!0})),a.default.createElement("div",{className:"pagelet-top-menu__account-button-container pagelet-top-menu__element"},h&&(_?a.default.createElement(u.AccountMenuV2,{user:f,showInstallLink:!n}):a.default.createElement(c.AccountMenu,{user:f,viewer:p,featuresConfig:m,hideInstallLink:n,dropdownHorizontalDisplacement:-40}))))},t})((a=n.__importDefault(a)).default.Component);t.PageletTopMenuContainer=i,t.RootComponent=function(e){return a.default.createElement(i,n.__assign({},e))}}));
//# sourceMappingURL=pkg-header.min.js-vflW34Sid.map